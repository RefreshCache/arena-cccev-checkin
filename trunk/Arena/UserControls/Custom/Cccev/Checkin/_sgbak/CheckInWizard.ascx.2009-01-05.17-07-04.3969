<%@ Control Language="C#" AutoEventWireup="true" CodeFile="CheckInWizard.ascx.cs" Inherits="ArenaWeb.UserControls.Custom.Cccev.Checkin.CheckInWizard" %>

<script type="text/javascript">
    var txtPhone;
    var button;
    var label;
    var maxDigits;

    function pageLoad() 
    {
        txtPhone = document.getElementById('<%= txtPhone.ClientID %>');
        button = document.getElementById('<%= btnFamilySearch.ClientID %>');
        label = document.getElementById('<%= lblMessage.ClientID %>');
        maxDigits = parseInt('<%= PhoneLengthSetting %>');
    }

    function FireDefaultButton(event, target) {
        var key_Zero = 47;
        var key_Nine = 57;

        if ((event.keyCode == 13 || event.which == 13) && !(event.srcElement && (event.srcElement.tagName.toLowerCase() == 'textarea'))) {
            var defaultButton = document.getElementById(target);
            if (defaultButton == 'undefined') defaultButton = document.all[target];

            if (defaultButton && typeof (defaultButton.click) != 'undefined') {
                Search();
                defaultButton.click();

                txtPhone.disabled = true;
                event.cancelBubble = true;
                if (event.stopPropagation) event.stopPropagation();
                return false;
            }
        }
        else if (event && event.keyCode >= key_Zero && event.keyCode <= key_Nine) {
            // if there are already 9 numbers then this is the 10th...
            if (txtPhone.value.length >= 9) {
                ClickDigit(String.fromCharCode(event.keyCode));
                txtPhone.disabled = true;
                event.cancelBubble = true;
                if (event.stopPropagation) event.stopPropagation();
                return false;
            }
        }
        return true;
    }

    function GetKeys() {
        var key_Enter = 13;
        var key_Zero = 47;
        var key_Nine = 57;

        if (window.event && window.event.keyCode == key_Enter) {
            if (txtPhone.value.length >= maxDigits) {
                Search();
                txtPhone.disabled = true;
                ClickDigit('');
                window.event.cancelBubble = true;
                if (event.stopPropagation) event.stopPropagation();
                return false;
            }
            else {
                IncompleteEntry();
            }
        }
        else if (window.event && window.event.keyCode >= key_Zero && window.event.keyCode <= key_Nine) {
            // if there are already 9 numbers then this is the 10th...
            if (txtPhone.value.length >= 9) {
                ClickDigit(String.fromCharCode(event.keyCode));
            }
        }
    }

    function ClickDigit(digit) {
        txtPhone.focus();
        if (parseInt(digit) >= 0) {
            txtPhone.value = txtPhone.value + digit;
        }

        // once the person has entered all ten digits, submit by navigating to the
        // same page with the digits in the txtPhone name/value pair.
        if (txtPhone.value.length >= maxDigits) {
            Search();

            button.click();
            txtPhone.disabled = true;
            button.disabled = true;
        }

        return false;
    }

    function ClearDigit() {
        txtPhone.value = txtPhone.value.substring(0, txtPhone.value.length - 1);
        txtPhone.focus();
    }

    function ClearAll() {
        txtPhone.value = '';
        label.innerHTML = '&nbsp;';
        div = document.getElementById("ScrollArea");
        div.innerHTML = '';
        txtPhone.focus();

        return false;
    }

    function IncompleteEntry() {
        label.innerHTML = 'Please enter all ' + maxDigits + ' digits.';
        label.style.color = 'red';
    }

    function Search() {
        div = document.getElementById("ScrollArea");
        div.innerHTML = '';
        label.innerHTML = 'Searching...';
        label.style.color = '#1B4472';

        return true;
    }
</script>

<asp:UpdatePanel ID="upCheckin" runat="server" UpdateMode="Always">
    <ContentTemplate>
        <div class="LeftBar"></div>
        <asp:Panel ID="pnlTitle" runat="server">
            <asp:Label ID="lblTitle" runat="server" CssClass="formTitle" /><br />
            <asp:Label ID="lblSubTitle" runat="server" CssClass="formSubTitle" />
        </asp:Panel>
    
        <!-- Begin Views -->
        
        <!-- Init State -->
        <asp:Panel ID="pnlInit" runat="server" DefaultButton="btnScan">
            <div style="text-align: center">
                <asp:Label id="lblTimeRemaining" Visible="false" Runat="server" CssClass="CountDown" />
            </div>
            <asp:panel id="pnlSwipeCard" runat="server" Visible="false">
		        <span class="ButtonText" style="vertical-align: middle"><%= ScanNowMessageSetting %></span>
		        <asp:Button id="btnSearchByPhone" CssClass="SmallButtonText" style="vertical-align: middle" runat="server" Visible="false" Text="Search By Phone" 
		            OnClick="btnSearchByPhone_Click" />
	        </asp:panel>
	        <asp:textbox id="tbScan" tabIndex="0" runat="server" Font-Size="1pt" BackColor="White" ForeColor="White" BorderStyle="None" MaxLength="12" Width="1pt" />
	        <asp:Button ID="btnScan" runat="server" OnClick="btnScan_Click" />
        </asp:Panel>
        
        <!-- Family Search State -->
        <asp:Panel ID="pnlFamilySearch" runat="server">
            <div class="MainArea" style="text-align:left; padding-top:10px;">
	            <table style="border: none;">
		            <tr>
			            <td style="vertical-align: top;">
				            <table id="Table2" style="height: 302px; width: 286px; border: none; padding: 2px;" cellspacing="0">
					            <tr style="vertical-align: top;">
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '1' )" type="button" value="1"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '2' )" type="button" value="2"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '3' )" type="button" value="3"></td>
					            </tr>
					            <tr style="vertical-align: middle;">
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '4' )" type="button" value="4"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '5' )" type="button" value="5"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '6' )" type="button" value="6"></td>
					            </tr>
					            <tr style="vertical-align: middle;">
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '7' )" type="button" value="7"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '8' )" type="button" value="8"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '9' )" type="button" value="9"></td>
					            </tr>
					            <tr style="vertical-align: middle;">
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClearDigit( )" type="button" value="<"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClickDigit( '0' )" type="button" value="0"></td>
						            <td style="vertical-align: middle; text-align: center;"><input class="NumericButton_Up" onclick="return ClearAll()" type="button" value="clr"></td>
					            </tr>
				            </table>
				            <p>&nbsp;</p>
				            <p>&nbsp;</p>
			            </td>
			            <td style="vertical-align: top; padding-left: 20px">
				            <p><div style="vertical-align: middle" onkeypress="javascript:return FireDefaultButton(event,'btnFamilySearch')"><asp:textbox class="text" id="txtPhone" tabIndex="0" runat="server" CssClass="ButtonText" Width="280px"
						            MaxLength="10" BorderStyle="Solid" BorderColor="Silver"></asp:textbox>&nbsp;&nbsp;<asp:button id="btnFamilySearch" runat="server" CssClass="SmallButtonText" Text="Search" OnClick="btnFamilySearch_Click"></asp:button></div><br />
					            <asp:Label id="lblMessage" runat="server" CssClass="SubInstructions" Visible="true"></asp:Label></p>
				            <div class="ScrollArea" id="ScrollArea">
				                <asp:datalist id="dgFamilies" runat="server" RepeatColumns="1" CellSpacing="5" DataKeyField="FamilyID" 
				                    OnSelectedIndexChanged="dgFamilies_SelectedIndexChanged" OnItemDataBound="dgFamilies_ItemDataBound">
						            <ItemTemplate>
							            <asp:Button runat="server" ID="FamilyID" CommandName="Select" CausesValidation="false" CssClass="WideButtonText" />
						            </ItemTemplate>
					            </asp:datalist>
					        </div>
			            </td>
		            </tr>
	            </table>
            </div>
            <div class="BottomBar">
	            <div class="BottomButtons">
		            <asp:button id="btnFamilySearchCancel" CssClass="SmallButtonText" runat="server" Text="Cancel" OnClick="Cancel_Click" />
	            </div>
            </div>
            <script type="text/javascript">
                txtPhone = document.getElementById( '<%= txtPhone.ClientID %>' );
                txtPhone.focus();
            </script>
        </asp:Panel>

        <!-- Select Family Member State -->
        <asp:Panel ID="pnlSelectFamilyMember" runat="server">
            <div class="MainArea">
	            <asp:DataList id="dgFamilyMembers" runat="server" DataKeyField="PersonID" 
		            CellSpacing="5" RepeatColumns="1" BorderColor="Black" BorderWidth="0" Width="350px"
		            onselectedindexchanged="dgFamilyMembers_SelectedIndexChanged" 
		            ItemStyle-HorizontalAlign="Left" GridLines="Both">
                    <ItemStyle HorizontalAlign="Left"></ItemStyle>
		            <ItemTemplate>
			            <asp:Button runat="server" ID="btnPerson" Text='<%# DataBinder.Eval(Container, "DataItem.FirstName") %>' CommandArgument='<%# DataBinder.Eval(Container, "DataItem.PersonID") %>' CommandName="Select" CausesValidation="false" CssClass="SmallButtonText" >
			            </asp:Button><asp:Image id="imgChecked" runat="server" Visible="false" style="margin-left:5px; margin-bottom:5px;" ImageUrl="misc/checkbox.png"></asp:Image>
		            </ItemTemplate>
	            </asp:DataList>
            </div>

            <div class="BottomBar BottomButtons">
            <asp:Button ID="btnSelectFamilyMemberCancel" runat="server" Text="  Done  " 
		            CssClass="SmallButtonText" onclick="Cancel_Click"  style="margin-right: 20px;"/> &nbsp;
            <asp:Button ID="btnSelectFamilyMemberContinue" runat="server" Text="Continue >" 
		            CssClass="SmallButtonText" onclick="btnSelectFamilyMemberContinue_Click"/>
            </div>
        </asp:Panel>
        
        <!-- No Young Children State -->
        <asp:Panel ID="pnlNoEligiblePeople" runat="server">
            <asp:Label ID="lblNoEligiblePeople" runat="server" CssClass="ButtonText" Visible="false" />
            <div class="BottomBar">
	            <div class="BottomButtons">
		            <asp:button id="btnNoPeopleCancel" CssClass="SmallButtonText" runat="server" Text="Cancel" OnClick="Cancel_Click" />
	            </div>
            </div>
        </asp:Panel>

        <!-- Select Ability State -->
        <asp:Panel ID="pnlSelectAbility" runat="server">
            <div class="MainArea">
            <br />
	            <asp:Label ID="lblPersonName" runat="server" CssClass="SubInstructions"></asp:Label>
	            <br />
	            <asp:DataList id="dgAbilities" runat="server" DataKeyField="LookupID" 
		            CellSpacing="5" RepeatColumns="1" BorderColor="Black" 
		            onselectedindexchanged="dgAbilities_SelectedIndexChanged" ItemStyle-HorizontalAlign="Left">
		            <ItemTemplate>
			            <asp:Button runat="server" ID="lookupID" Text='<%# DataBinder.Eval(Container, "DataItem.Value") %>' CommandArgument='<%# DataBinder.Eval(Container, "DataItem.LookupID") %>' CommandName="Select" CausesValidation="false" CssClass="WideButtonText" />
			            <asp:Image ID="imgChecked" runat="server" ImageUrl="UserControls/Custom/Cccev/CheckIn/misc/checked.gif" Visible="false" />
		            </ItemTemplate>
	            </asp:DataList>
            </div>

            <div class="BottomBar BottomButtons">
            <asp:Button ID="btnAbilityCancel" runat="server" Text="Cancel" CssClass="SmallButtonText" onclick="Cancel_Click" style="float: left; margin-left: 160px;"/>
            </div>
        </asp:Panel>

        <!-- Select Service State -->
        <asp:Panel ID="pnlSelectService" runat="server">
            <div class="MainArea">
                <br />
                <br />
                <br />
                <asp:DataList ID="dgEventTimes" runat="server" CellSpacing="5" RepeatColumns="1" BorderColor="Black" BorderWidth="0" Width="350" 
                    OnSelectedIndexChanged="dgEventTimes_SelectedIndexChanged" OnItemDataBound="dgEventTimes_ItemDataBound" ItemStyle-HorizontalAlign="Left">
                    <ItemTemplate>
                        <div class="item">
                            <asp:Button runat="server" ID="btnService" CommandName="Select" CausesValidation="false" CssClass="SmallButtonText" style="float: left">
                            </asp:Button><asp:Image id="imgChecked" runat="server" Visible="false" style="margin-bottom: 0px; margin-left: 5px" ImageUrl="misc/checkbox.png" />
                        </div>
                    </ItemTemplate>
                </asp:DataList>
            </div>

            <div class="BottomBar BottomButtons">
            <asp:Button ID="btnCancel" runat="server" Text="Cancel" 
		            CssClass="SmallButtonText" onclick="Cancel_Click" style="float: left; margin-left: 160px;"/>
            <asp:Button ID="btnServicesContinue" runat="server" Text="Continue >" 
		            CssClass="SmallButtonText" onclick="btnServicesContinue_Click" style="float: right; margin-right: 20px;"/>
            </div>
        </asp:Panel>

        <!-- Confirm State -->
        <asp:Panel ID="pnlConfirm" runat="server">
            <div class="MainArea">
                <p><asp:Label ID="lblConfirmError" runat="server" Visible="false" /></p>
                <asp:PlaceHolder ID="phConfirm" runat="server" />
            </div>
            <div class="BottomBar BottomButtons">
                <asp:Button ID="btnConfirmCancel" runat="server" Text="Cancel"
                    CssClass="SmallButtonText" onclick="Cancel_Click" style="float: left; margin-left: 160px;"/>
                <asp:Button ID="btnConfirmContinue" runat="server" Text="Continue >" 
		            CssClass="SmallButtonText" onclick="btnConfirmContinue_Click" style="float: right; margin-right: 20px;"/>
            </div>
        </asp:Panel>

        <!-- Result State -->
        <asp:Panel ID="pnlResults" runat="server">
            <div class="MainArea">
                <asp:PlaceHolder ID="phResults" runat="server" />
            </div>
            <div class="BottomBar BottomButtons">
                <asp:Button ID="btnResultsContinue" runat="server" Text="Continue >" 
		            CssClass="SmallButtonText" onclick="btnResultsContinue_Click" style="float: right; margin-right: 20px;"/>
            </div>
        </asp:Panel>
        
        
        <asp:Panel ID="pnlBadKiosk" runat="server">
            <div class="MainArea">
                <asp:Label ID="lblBadKiosk" runat="server" CssClass="ButtonText" />
            </div>
            <div class="BottomBar BottomButtons">
                <asp:Button ID="btnTryAgain" runat="server" Text="Try Again" 
		            CssClass="SmallButtonText" onclick="btnTryAgain_Click" style="float: right; margin-right: 20px;"/>
            </div>
        </asp:Panel>

        <!-- End Views -->
    
    </ContentTemplate>
</asp:UpdatePanel>
